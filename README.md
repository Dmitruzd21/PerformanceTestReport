# **Performance Test Report**

**Ссылка на задание/требования:** https://github.com/netology-code/loadqa-homeworks/blob/main/5.Metrics/homework_lecture5.md

## **Ссылки на предыдущие работы:**

- Сбор информации и создание профиля нагрузки: https://github.com/Dmitruzd21/IntroductionToPerformanceTesting
- Мониторинг:

https://github.com/Dmitruzd21/telegraf

https://github.com/Dmitruzd21/prometheus

- Проведение нагрузочного тестирования WEB: https://github.com/Dmitruzd21/JMeterAndBlazeMeter
- Проведение нагрузочного тестирования DB: https://github.com/Dmitruzd21/LoadDB

## **Краткое описание**

Данный отчет представляет итоги проведения тестирования производительности сервиса бронирования билетов (нагрузочное тестирование), а также сервиса WordPress c постами и комментариями (объемное тестирование).

## **Задачи**

В рамках тетстирования производительности было несколько задач:

- Провести прогноз количества посетителей сервиса бронирования билетов при увеличении количества кинотеатров в разных городах;

- Создать профиль нагрузочного тестирования

- Определить параметры тестовой среды исходя из среды, на которой расположен сервис бронирования билетов;

- Провести нагрузочное тестирование сервиса бронирования билетов;

- Провести объемное тестирование СУБД сервиса WordPress c постами и комментариями;

- Провести параллельное объемное и нагрузочное тестирование сервиса WordPress с постами и комментариями;

- Оценить состояние базовых параметров оборудования/ОС при проведении нагрузочного тетстирования.

## **Используемые инструменты (ПО)**

- Для нагрузочного тетсирования: JMeter и BlazeMeter.

- Для объемного тестирования: JMeter.

- Для мониторинга системы: Telegraph + InfluxDB + Grafana и node-exporter + prometheu + Grafana.

## **Ожидаемое количество посетителей сервиса бронирования билетов**

| Параметры                                                   | Результаты                                                                                                                            |
| ----------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| Количество посетителей в сутки во всех кинотеатрах          | Ожидается 2 003 посетителей в сутки во все кинотеатры сети, если предположить, что в будние и в выходные дни посещаемость одинаковая. |
| Количество посетителей в выходные дни                       | Посещаемость в выходные дни обычно увеличивается в 2 раза, таким образом, количество посетителей может возрасти до 4 006 в сутки.     |
| Влияение того, что города находятся в разных часовых поясах | В выходные дни с 10 до 13 по московскому времени совпадают пики посещаемости в Москве и во Владивостоке!!!                            |
| Ожидаемое количество посетителей на сайте в выходной день   | Гостей - 1 602, Покупатели онлайн - 2 603, Продавец - 1 402, Администратор - 15                                                       |

## **Тестовая среда**

| Параметры               | Значения          |
| ----------------------- | ----------------- |
| Особенности сервера     | Выделенный сервер |
| Количество серверов     | Один              |
| CPU - количество ядер   | 8 ядер            |
| RAM                     | 64 Гб             |
| Disk SSD                | Один Тб           |
| Поправочный коэффициент | 2                 |

**Примечание:** тестирование выполнялось на ПК

# **Результаты профиля нагрузочного тестирования сервиса бронирования билетов**

| Параметры                                                                                        | Значения                                                                                       |
| ------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------- |
| Роли                                                                                             | Гость (2 сценария), Покупатель (3 сценария), Продавец (1 сценирий), Администратор (1 сценарий) |
| Общее количество сценариев                                                                       | 7                                                                                              |
| Интервал, сек                                                                                    | 3600                                                                                           |
| Суммарное количество потоков(пользователей) за измеряемый интервал времени, выполняющих сценарий | 469                                                                                            |
| Общее количество запросов за интервал                                                            | 2 952                                                                                          |
| RPS                                                                                              | 53,73                                                                                          |
| RPS с учетом поправочного коэффициента                                                           | 26,8                                                                                           |

## **Результаты нагрузочного тестирования сервиса бронирования билетов**

**Примечание:** упрощение в том, что прогоняется один сценарий (покупка билета в кинотеатре и получение QR кода).

**Результаты при заданной (оптимальной) нагрузке с учетом рассчитанного количества посетителей сервиса**

RPS c учетом поправочного коэффициента: 26,8.

Схема достижения необходимого RPS: количество тредов - 50, количество повторений - 100.

![RPS при обычной нагурзке](/Load/Usual/RPSinUsual.png)

![Распределение времени ответов при обычной нагрузке](/Load/Usual/DistributionInUsual.png)

![Перцентили при обычной нагрузке](/Load/Usual/PercentilesInUsual.png)

![Отчет при обычной нагрузке](/Load/Usual/AggregateReportInUsual.png)

![Influxdb1 при обычной нагрузке](/Load/Usual/influxdbDuringUsual.png)

![Influxdb2 при обычной нагрузке](/Load/Usual/influxdbDuringUsual2.png)

**Выводы:**

- Сервис эффективно работает при достижении заданного RPS.

**Результаты выявления предела нагрузки (постепенное возрастание нагрузки - выше расчитанного RPS)**

Схема: увеличение количество тредов на 10 каждую 1 сек до достижения 400 тредов.

Критерии предела нагрузки:

- Появление ответов с кодами ошибок/другие ошибки (более 5%)
- Длительное время ответа на запросы: > 10 сек

![Схема нагрузки](/Load/Overload/shedule.png)

![Количество запросов](/Load/Overload/HPS.png)

![Коды](/Load/Overload/codes.png)

![Время отклика](/Load/Overload/Latencies.png)

![Распределение времени ответа](/Load/Overload/timeDistribution.png)

![Перцентили](/Load/Overload/Percentilies.png)

![Отчет](/Load/Overload/AggregateReport.png)

![Influxdb1 при высокой нагрузке](/Load/Overload/influxdbDuringOverload1.png)

![Influxdb2 при высокой нагрузке](/Load/Overload/influxdbDuringOverload2.png)

**Выводы:**

- Точка предела нагрузки: 276 тредов, RPS от 60 до 90. Причина автоматической остановки теста - появление ошибок ("Non HTTP response code: java.net.SocketException");

- Наибольшее количество ошибок при открытии страницы.

## **Результаты мониторинга системы при выполнении нагрузочного тестирования сервиса бронирования билетов в кинотеатр**

**При обычном нагрузочном тестировании**

Прараметры нагрузочного тестирования (пиковые, по данным JMeter): количество тредов - 50, RPS - от 20 до 30.

![CPU при обычной нагрузке](/Monitoring/CPUduringUsual.png)

**Выводы:** Нагруженность системы увеличилась на 1,5 - 2%. Система хорошо функционирует при обычной нагрузке.

**При поиске предела производительности**

Прараметры нагрузочного тестирования (пиковые, по данным JMeter): количество тредов 276, RPS - от 60 до 90.

![CPU при высокой нагрузке](/Monitoring/CPUduringOverload.png)

**Выводы:** Нагруженность системы увеличилась на 12%. Стенд тестирования справился с высокой нагрузкой.

## **Результаты объемного тестирования СУБД сервиса WordPress c постами и комментариями**

**Выводы:**

- Подтверждено, что в СУБД может быть создано 552 576 записей с комментариями

- Количество строк в таблице wp_comments не влияет на время отклика

## **Результаты параллельного объемного и нагрузочного тестирования сервиса WordPress с постами и комментариями**

![Момент создания 9 694 записей](/DB/9694.png)

![36 592 в момент падения](/DB/36592tree.png)

**Выводы:**

- Если в таблице появляется около 9 694 записей, то пользователи будут ожидать загрузку страницы с комментариями более/равно 20 сек;

- Если в таблице появляется около 36 592 записей, то пользователи не смогут добавить комментарий в графическом интерфейсе.

## **Рекомендации для сервиса бронирования билетов**

Сервис хорошо функционирует при заданных условиях нагрузки. Ресурсов системы достаточно для обеспечения бесперебойной работы.

Явная оптимизация не требуется.

## **Рекомендации для оптимизации сервиса WordPress**

- Рекомендуется контролировать количество комментариев к одному посту. Не более 10 000 комментариев. Возможно переодическое удаление старых комментариев, если общее количество комментариев приближается к 9000. Также возможно оптимизация взаимодействия ПО бэкенда с СУБД. После оптимизации необходимо повторно провести параллельное объемное и WEB тестирование.

- При текущем состоянии строго не рекомендуется хранить более 35 000 комментариев к посту, поскольку это приведет к невозможности добавлять новые комментарии.
